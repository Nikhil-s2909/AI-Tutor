{% extends 'base.html' %}
{% load static %}
{% block title %}AI Tutor Chat{% endblock %}
{% block content %}

<!-- <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Tutor Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->
  <style>
    body { background:#f8f9fa; }
    .sidebar { max-width: 320px; min-width:240px; }
    .avatar { width:120px; height:120px; border-radius:50%; overflow:hidden; margin:0 auto; }
    .avatar img { width:100%; height:100%; object-fit:cover; display:block; }
    .chat-box { height: 70vh; background:#fff; border-radius:8px; padding:16px; overflow:auto; }
    .list-item-small { font-size:0.95rem; }
    @media (max-width: 768px) {
      .sidebar { display:none; }
    }
  </style>
</head>
<body>
<div class="container py-4">
  <div class="row g-3">
    <div class="col-md-3 sidebar p-3 bg-white shadow-sm">
      <div class="text-center mb-3">
        <div class="avatar mb-2">
          <img src="{% static 'images/avatar.gif' %}" alt="AI Tutor">
        </div>
        <h5>AI Tutor</h5>
      </div>

      <!-- <h6 class="mb-2">Syllabus</h6>
      <ul class="list-group mb-3">
        {% for s in syllabus %}
          <li class="list-group-item list-item-small">
            <strong>{{ s.order }}. {{ s.title }}</strong><br>
            <small>{{ s.description|truncatechars:80 }}</small>
          </li>
        {% empty %}
          <li class="list-group-item">No syllabus added yet.</li>
        {% endfor %}
      </ul> -->
<h6 class="mb-2">Syllabus</h6>
<div class="list-group mb-3">
  {% if request.user.student.course %}
    <div class="list-group-item">
      <strong>{{ request.user.student.course.name }}</strong><br>
      <small>{{ request.user.student.course.syllabus|linebreaks }}</small>
    </div>
  {% else %}
    <div class="list-group-item">No syllabus added yet.</div>
  {% endif %}
</div>

      <h6 class="mb-2">Class Timings</h6>
      <ul class="list-group">
        {% for t in timings %}
          <li class="list-group-item list-item-small">
            <strong>{{ t.subject }}</strong><br>
            <small>{{ t.day }}: {{ t.start_time }} - {{ t.end_time }}</small>
          </li>
        {% empty %}
          <li class="list-group-item">No class timings.</li>
        {% endfor %}
      </ul>
    </div>

  <div class="col-md-8">
    <div id="chatbox" class="border rounded p-3 mb-2" style="height:360px; overflow:auto;"></div>
    <div class="input-group">
      <input id="question" class="form-control" placeholder="Type your question...">
      <button id="sendBtn" class="btn btn-primary">Send</button>
    </div>
  </div>
</div>
        </div>
        
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  const chat = document.getElementById('chatbox');
  const q = document.getElementById('question');
  const btn = document.getElementById('sendBtn');

  function add(line, who){
    const p = document.createElement('p');
    p.innerHTML = '<b>' + who + ':</b> ' + line;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  }

  async function ask(){
    const question = q.value.trim();
    if(!question){ return; }
    add(question, 'You');
    q.value='';
    const res = await fetch('/tutor/ask/', {
      method:'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({question})
    });
    const data = await res.json();
    add(data.answer || 'No answer', 'Tutor');
  }

  btn.addEventListener('click', ask);
  q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ ask(); }});
</script>
{% endblock %}


